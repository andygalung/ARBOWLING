<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Bowling Game Deluxe</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script>
    // Register components after the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Camera shake component for impact effects
      AFRAME.registerComponent('camera-shake', {
        schema: {
          intensity: {type: 'number', default: 0.01},
          decay: {type: 'number', default: 0.9},
          duration: {type: 'number', default: 300}
        },
        init: function() {
          this.shaking = false;
          this.elPosition = new THREE.Vector3();
          this.originalPosition = new THREE.Vector3();
          this.startTime = 0;
          
          // Listen for shake events
          const scene = document.querySelector('a-scene');
          scene.addEventListener('shake', this.onShake.bind(this));
        },
        onShake: function(evt) {
          if (!this.shaking) {
            // Store original position
            this.originalPosition.copy(this.el.object3D.position);
            this.elPosition.copy(this.originalPosition);
            this.shaking = true;
            this.startTime = Date.now();
            this.intensity = evt.detail.intensity || this.data.intensity;
            this.duration = evt.detail.duration || this.data.duration;
          }
        },
        tick: function() {
          if (!this.shaking) return;
          
          // Calculate shake based on elapsed time
          const elapsed = Date.now() - this.startTime;
          if (elapsed > this.duration) {
            // Reset position and stop shaking
            this.el.object3D.position.copy(this.originalPosition);
            this.shaking = false;
            return;
          }
          
          // Calculate intensity based on remaining time
          const remainingTime = 1 - (elapsed / this.duration);
          const currentIntensity = this.intensity * remainingTime;
          
          // Apply random offset to camera
          this.el.object3D.position.set(
            this.originalPosition.x + (Math.random() * 2 - 1) * currentIntensity,
            this.originalPosition.y + (Math.random() * 2 - 1) * currentIntensity,
            this.originalPosition.z + (Math.random() * 2 - 1) * currentIntensity
          );
        }
      });
      
      // Enhanced sound effects with more variations
      const sounds = {
        roll: new Howl({ src: ['https://cdn.freesound.org/previews/685/685513_11861866-lq.mp3'] }),
        rollHeavy: new Howl({ src: ['https://cdn.freesound.org/previews/319/319997_5436764-lq.mp3'], volume: 0.7 }), // Heavier rolling sound
        pinHit: new Howl({ src: ['https://cdn.freesound.org/previews/683/683535_11861866-lq.mp3'] }),
        pinHitHard: new Howl({ src: ['https://cdn.freesound.org/previews/512/512216_2393266-lq.mp3'], volume: 0.8 }), // Harder pin hit
        pinCollision: new Howl({ src: ['https://cdn.freesound.org/previews/118/118513_2095793-lq.mp3'], volume: 0.6 }), // Pin-to-pin collision
        strike: new Howl({ src: ['https://cdn.freesound.org/previews/459/459825_4128064-lq.mp3'], volume: 0.9 }),
        pickup: new Howl({ src: ['https://cdn.freesound.org/previews/420/420252_7930927-lq.mp3'] }),
        ballBounce: new Howl({ src: ['https://cdn.freesound.org/previews/240/240765_4284968-lq.mp3'], volume: 0.7 }) // Ball bounce sound
      };

      // Fungsi untuk menangani musik
      let bgMusic;
      
      window.toggleMusicOn = function() {
        if (!bgMusic) {
          bgMusic = new Howl({
            src: ['https://cdn.freesound.org/previews/393/393520_5121236-lq.mp3'],
            loop: true,
            volume: 0.5
          });
        }
        bgMusic.play();
      };
      
      window.toggleMusicOff = function() {
        if (bgMusic) {
          bgMusic.pause();
        }
      };
      
      // Fungsi untuk menangani klik tombol
      window.handleClick = function() {
        const clickButton = document.querySelector('#click-button');
        const throwButton = document.querySelector('#throw-button');
        
        // Sembunyikan tombol klik
        clickButton.setAttribute('visible', false);
        
        // Tampilkan tombol lempar
        throwButton.setAttribute('visible', true);
        throwButton.setAttribute('animation__pulse', 'property: scale; from: 1 1 1; to: 1.1 1.1 1.1; dir: alternate; dur: 500; loop: true');
        
        // Tampilkan pesan
        document.querySelector('#message-display').setAttribute('value', 'Siap untuk melempar!');
      };
      
      // Ball control component with improved physics and animations
      AFRAME.registerComponent('ball-control', {
        init: function() {
          const ball = this.el;
          let isRolling = false;
          let score = 0;
          let frameCount = 0;
          const pins = document.querySelectorAll('.pin');
          const scoreDisplay = document.querySelector('#score-display');
          const frameDisplay = document.querySelector('#frame-display');
          
          // Ball physics properties
          const ballPhysics = {
            rotationSpeed: 0, 
            velocity: {x: 0, y: 0, z: 0},
            spin: {x: 0, y: 0, z: 0}
          };
          
          // Ball animation dengan efek rotasi yang lebih realistis
          AFRAME.registerComponent('ball-animation', {
            tick: function(time, timeDelta) {
              if (isRolling) {
                const rotation = ball.getAttribute('rotation');
                // Rotasi yang lebih cepat dan terlihat jelas
                ball.setAttribute('rotation', {
                  x: rotation.x + ballPhysics.spin.x * timeDelta / 30, // Lebih cepat dengan nilai 30 (sebelumnya 50)
                  y: rotation.y + ballPhysics.spin.y * timeDelta / 30,
                  z: rotation.z + ballPhysics.spin.z * timeDelta / 30
                });
                
                // Tambahkan efek visual saat bola berputar
                if (time % 100 < 20 && Math.random() > 0.7) { // Sesekali tambahkan partikel saat berputar
                  const glowEffect = document.querySelector('#ball-glow');
                  glowEffect.setAttribute('visible', true);
                  glowEffect.setAttribute('scale', '0.8 0.8 0.8');
                  setTimeout(() => {
                    glowEffect.setAttribute('visible', false);
                  }, 50);
                }
              }
            }
          });
          
          ball.setAttribute('ball-animation', '');
          
          // Reset the bowling scene
          window.resetScene = function() {
            // Reset ball position with smooth transition
            const ballReset = document.createElement('a-animation');
            ballReset.setAttribute('attribute', 'position');
            ballReset.setAttribute('to', '0 0.3 1');
            ballReset.setAttribute('dur', '1000');
            ballReset.setAttribute('easing', 'ease-out');
            ball.appendChild(ballReset);
            
            ball.setAttribute('visible', true);
            isRolling = false;
            
            // Reset pins with staggered animation
            pins.forEach(function(pin, index) {
              setTimeout(() => {
                const resetAnim = document.createElement('a-animation');
                resetAnim.setAttribute('attribute', 'position');
                resetAnim.setAttribute('to', getPinPosition(index));
                resetAnim.setAttribute('dur', '500');
                resetAnim.setAttribute('easing', 'ease-out');
                pin.appendChild(resetAnim);
                
                const rotResetAnim = document.createElement('a-animation');
                rotResetAnim.setAttribute('attribute', 'rotation');
                rotResetAnim.setAttribute('to', '0 0 0');
                rotResetAnim.setAttribute('dur', '500');
                rotResetAnim.setAttribute('easing', 'ease-out');
                pin.appendChild(rotResetAnim);
                
                pin.setAttribute('visible', true);
              }, index * 100); // Staggered reset
            });
            
            // Show throw button with fade-in effect
            const throwButton = document.querySelector('#throw-button');
            throwButton.setAttribute('visible', true);
            throwButton.setAttribute('opacity', 0);
            const throwButtonAnim = document.createElement('a-animation');
            throwButtonAnim.setAttribute('attribute', 'opacity');
            throwButtonAnim.setAttribute('to', '1');
            throwButtonAnim.setAttribute('dur', '500');
            throwButton.appendChild(throwButtonAnim);
            
            document.querySelector('#message-display').setAttribute('value', 'Siap untuk melempar!');
            
            // Reset frame counter for new game if needed
            if (frameCount >= 10) {
              frameCount = 0;
              score = 0;
              scoreDisplay.setAttribute('value', 'Skor: 0');
            }
            
            frameDisplay.setAttribute('value', 'Frame: ' + (frameCount + 1) + '/10');
            
            // Hide reset button
            document.querySelector('#reset-button').setAttribute('visible', false);
            
            // Show particle system for new frame
            const particleSystem = document.querySelector('#new-frame-particles');
            particleSystem.setAttribute('visible', true);
            setTimeout(() => {
              particleSystem.setAttribute('visible', false);
            }, 2000);
          }
          
          // Get position for pins based on classic bowling formation
          function getPinPosition(index) {
            const positions = [
              '0 0.25 -10',
              '-0.3 0.25 -10.5', '0.3 0.25 -10.5',
              '-0.6 0.25 -11', '0 0.25 -11', '0.6 0.25 -11',
              '-0.9 0.25 -11.5', '-0.3 0.25 -11.5', '0.3 0.25 -11.5', '0.9 0.25 -11.5'
            ];
            return positions[index];
          }
          
          // Enhanced ball pickup animation
          ball.addEventListener('click', function() {
            if (!isRolling) {
              sounds.pickup.play();
              
              // Show hand briefly
              const hand = document.querySelector('#player-hand');
              hand.setAttribute('visible', true);
              
              // Move hand to ball
              const handMove = document.createElement('a-animation');
              handMove.setAttribute('attribute', 'position');
              handMove.setAttribute('to', ball.getAttribute('position').x + ' ' + ball.getAttribute('position').y + ' ' + (ball.getAttribute('position').z - 0.3));
              handMove.setAttribute('dur', '300');
              hand.appendChild(handMove);
              
              // After hand reaches ball, move ball to camera
              setTimeout(() => {
                // Move ball in front of camera with smooth animation
                const camera = document.querySelector('a-camera');
                const position = camera.getAttribute('position');
                
                const ballMove = document.createElement('a-animation');
                ballMove.setAttribute('attribute', 'position');
                ballMove.setAttribute('to', position.x + ' ' + (position.y - 0.3) + ' ' + (position.z + 0.5));
                ballMove.setAttribute('dur', '500');
                ballMove.setAttribute('easing', 'ease-out');
                ball.appendChild(ballMove);
                
                // Hide hand after animation
                setTimeout(() => {
                  hand.setAttribute('visible', false);
                  
                  // Show glow effect around ball
                  const glowEffect = document.querySelector('#ball-glow');
                  glowEffect.setAttribute('visible', true);
                  
                  // Show throw button with pulse animation
                  const throwButton = document.querySelector('#throw-button');
                  throwButton.setAttribute('visible', true);
                  throwButton.setAttribute('animation__pulse', 'property: scale; from: 1 1 1; to: 1.1 1.1 1.1; dir: alternate; dur: 500; loop: true');
                }, 500);
              }, 300);
            }
          });
          
          // Enhanced ball throwing function with realistic physics and animation
          window.throwBall = function() {
            if (isRolling) return;
            
            // Stop button pulse animation
            const throwButton = document.querySelector('#throw-button');
            throwButton.removeAttribute('animation__pulse');
            
            // Hide glow effect
            const glowEffect = document.querySelector('#ball-glow');
            glowEffect.setAttribute('visible', false);
            
            isRolling = true;
            throwButton.setAttribute('visible', false);
            document.querySelector('#message-display').setAttribute('value', 'Bola meluncur!');
            
            // Play rolling sound
            sounds.roll.play();
            
            // Get camera direction for throw with added physics
            const camera = document.querySelector('a-camera').object3D;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camera.quaternion);
            
            // Add some randomness to make it more realistic
            const randomX = (Math.random() - 0.5) * 0.1;
            direction.x += randomX;
            
            // Set ball physics properties dengan efek rotasi yang lebih kuat
            ballPhysics.spin.x = -15; // Forward roll yang lebih cepat
            ballPhysics.spin.y = randomX * 5; // Side spin yang lebih kuat
            ballPhysics.spin.z = randomX * 8; // Additional spin variation yang lebih terlihat
            
            // Get current ball position for animation
            const ballPosition = ball.getAttribute('position');
            
            // Create a more realistic bowling animation with enhanced arc, gravity and physics
            // First phase: Initial throw with more pronounced upward arc
            const initialHeight = ballPosition.y;
            const midPointZ = ballPosition.z - 5; // Midpoint of the lane
            const midPointHeight = initialHeight + 0.2; // More pronounced arc upward
            const initialTimeToTravel = 700; // ms for initial throw (slightly faster)
            
            // Add subtle wobble effect to ball during initial throw (reduced effect)
            ballPhysics.spin.z = randomX * 3; // Reduced side wobble for lighter effect
            
            // Initial throw animation with smoother, more natural arc
            const initialThrow = document.createElement('a-animation');
            initialThrow.setAttribute('attribute', 'position');
            initialThrow.setAttribute('from', ballPosition.x + ' ' + initialHeight + ' ' + ballPosition.z);
            initialThrow.setAttribute('to', (ballPosition.x + direction.x) + ' ' + midPointHeight + ' ' + midPointZ);
            initialThrow.setAttribute('dur', initialTimeToTravel);
            initialThrow.setAttribute('easing', 'ease-out');
            ball.appendChild(initialThrow);
            
            // Add rotation animation with more subtle spin (reduced intensity)
            const initialRotation = document.createElement('a-animation');
            initialRotation.setAttribute('attribute', 'rotation');
            initialRotation.setAttribute('from', '0 0 0');
            initialRotation.setAttribute('to', (randomX * 20) + ' ' + (randomX * 5) + ' ' + (randomX * 30)); // Reduced rotation values
            initialRotation.setAttribute('dur', initialTimeToTravel);
            initialRotation.setAttribute('easing', 'ease-out');
            ball.appendChild(initialRotation);
            
            // Second phase: Enhanced ball drop with more realistic physics and bounce
            const targetZ = -12; // End position (pins)
            const finalHeight = 0.3; // Final height on lane
            const secondPhaseTime = 1000; // ms for second phase (faster for more realistic acceleration)
            
            // Create the second phase animation with enhanced gravity effect
            setTimeout(() => {
              // Add bounce effect - first the ball hits the lane
              const bouncePhase = document.createElement('a-animation');
              bouncePhase.setAttribute('attribute', 'position');
              bouncePhase.setAttribute('from', (ballPosition.x + direction.x) + ' ' + midPointHeight + ' ' + midPointZ);
              bouncePhase.setAttribute('to', (ballPosition.x + direction.x * 1.5) + ' ' + 0.2 + ' ' + (midPointZ - 2));
              bouncePhase.setAttribute('dur', secondPhaseTime * 0.4);
              bouncePhase.setAttribute('easing', 'ease-in');
              ball.appendChild(bouncePhase);
              
              // Add small bounce up after hitting the lane
              setTimeout(() => {
                const smallBounce = document.createElement('a-animation');
                smallBounce.setAttribute('attribute', 'position');
                smallBounce.setAttribute('from', (ballPosition.x + direction.x * 1.5) + ' ' + 0.2 + ' ' + (midPointZ - 2));
                smallBounce.setAttribute('to', (ballPosition.x + direction.x * 1.7) + ' ' + 0.35 + ' ' + (midPointZ - 3));
                smallBounce.setAttribute('dur', secondPhaseTime * 0.2);
                smallBounce.setAttribute('easing', 'ease-out');
                ball.appendChild(smallBounce);
                
                // Final roll to pins after bounce - perbaikan animasi agar bola bergerak ke depan dengan benar
                setTimeout(() => {
                  const finalRoll = document.createElement('a-animation');
                  finalRoll.setAttribute('attribute', 'position');
                  finalRoll.setAttribute('from', (ballPosition.x + direction.x * 1.7) + ' ' + 0.35 + ' ' + (midPointZ - 3));
                  // Perbaikan: Pastikan bola bergerak jauh ke depan menuju pin
                  finalRoll.setAttribute('to', (ballPosition.x + direction.x * 2) + ' ' + finalHeight + ' ' + (targetZ - 2));
                  // Perbaikan: Durasi lebih cepat untuk gerakan yang lebih dinamis
                  finalRoll.setAttribute('dur', secondPhaseTime * 0.3);
                  finalRoll.setAttribute('easing', 'ease-in');
                  ball.appendChild(finalRoll);
                }, secondPhaseTime * 0.2);
              }, secondPhaseTime * 0.4);
              
              // Increase spin as ball accelerates with more dynamic rotation
              ballPhysics.spin.x = -15; // Faster forward spin
              ballPhysics.spin.z = randomX * 8; // Enhanced side spin based on direction
              
              // Add impact shake effect when ball hits lane
              const scene = document.querySelector('a-scene');
              scene.emit('shake', {duration: 300, intensity: 0.004}); // Stronger shake
              
              // Add lane impact sound with enhanced effect
              setTimeout(() => {
                // Play both roll and bounce sounds for richer audio effect
                sounds.rollHeavy.volume(1.8);
                sounds.rollHeavy.rate(0.7); // Deeper sound for impact
                sounds.rollHeavy.play();
                
                // Add bounce sound
                sounds.ballBounce.play();
                
                // Show impact flash effect
                const impactFlash = document.querySelector('#impact-flash');
                impactFlash.setAttribute('position', (ballPosition.x + direction.x * 1.5) + ' ' + 0.2 + ' ' + (midPointZ - 2));
                impactFlash.setAttribute('visible', true);
                setTimeout(() => {
                  impactFlash.setAttribute('visible', false);
                }, 300);
                
                // Add small shake to camera on bounce
                const scene = document.querySelector('a-scene');
                scene.emit('shake', {duration: 150, intensity: 0.002});
              }, 100);
              
              // Add second bounce sound for the small bounce
              setTimeout(() => {
                sounds.ballBounce.volume(0.5); // Quieter for small bounce
                sounds.ballBounce.rate(1.2); // Higher pitch for small bounce
                sounds.ballBounce.play();
              }, secondPhaseTime * 0.4 + 100);
            }, initialTimeToTravel);
            
            // Total animation time
            const totalAnimTime = initialTimeToTravel + secondPhaseTime;
            
            // Check for collisions after animation with realistic timing
            setTimeout(function() {
              // Perbaikan: Pastikan bola berada di posisi yang benar untuk tabrakan
              // Dapatkan posisi bola terbaru setelah animasi
              const finalBallPosition = ball.getAttribute('position');
              
              // Add impact shake effect when ball hits pins dengan getaran yang lebih kuat
              const scene = document.querySelector('a-scene');
              scene.emit('shake', {duration: 350, intensity: 0.01}); // Getaran lebih kuat dan lebih lama
              
              // Tambahkan efek flash saat bola menabrak pin - perbaikan posisi flash
              const impactFlash = document.createElement('a-entity');
              // Gunakan posisi bola untuk efek flash yang lebih akurat
              impactFlash.setAttribute('position', finalBallPosition.x + ' ' + 0.3 + ' ' + (finalBallPosition.z - 0.5));
              impactFlash.setAttribute('light', {
                type: 'point',
                color: '#ffffff',
                intensity: '2.0', // Intensitas lebih tinggi
                distance: '4'     // Jarak lebih jauh
              });
              document.querySelector('a-scene').appendChild(impactFlash);
              
              // Hapus flash setelah efek selesai
              setTimeout(() => {
                document.querySelector('a-scene').removeChild(impactFlash);
              }, 300); // Durasi lebih lama
              
              // Tambahkan efek partikel ledakan saat bola menabrak pin - perbaikan posisi partikel
              const impactExplosion = document.createElement('a-entity');
              // Gunakan posisi bola untuk efek partikel yang lebih akurat
              impactExplosion.setAttribute('position', finalBallPosition.x + ' ' + 0.3 + ' ' + (finalBallPosition.z - 0.5));
              impactExplosion.setAttribute('particle-system', {
                preset: 'dust',
                color: '#ffffff, #aaaaff, #ffaaaa', // Warna lebih bervariasi
                size: 0.12, // Ukuran lebih besar
                particleCount: 70, // Lebih banyak partikel
                maxAge: 1.2, // Lifetime lebih lama
                velocityValue: '0 3.5 0', // Kecepatan lebih tinggi
                velocitySpread: '3.5 2.5 3.5', // Spread lebih luas
                accelerationValue: '0 -10 0',
                opacity: 0.9, // Opacity lebih tinggi
                blending: 'additive'
              });
              document.querySelector('a-scene').appendChild(impactExplosion);
              
              // Hapus partikel setelah efek selesai
              setTimeout(() => {
                document.querySelector('a-scene').removeChild(impactExplosion);
              }, 1200); // Durasi lebih lama
              
              // Perbaikan: Tambahkan delay kecil sebelum memanggil checkCollisions untuk memastikan posisi bola sudah diperbarui
              setTimeout(() => {
                checkCollisions();
              }, 50);
            }, totalAnimTime + 50); // Waktu yang lebih tepat
            
            // Enhanced particle trail effect untuk bola yang berputar
            const particleTrail = document.querySelector('#ball-trail');
            particleTrail.setAttribute('position', ball.getAttribute('position'));
            particleTrail.setAttribute('visible', true);
            particleTrail.setAttribute('particle-system', 'particleCount: 80; maxAge: 1.5; velocityValue: 0 0 -1.2; accelerationValue: 0 -0.3 0; color: #3333ff, #0000aa, #6666ff; opacity: 0.8; blending: additive'); // Lebih banyak partikel dan efek yang lebih dinamis
            
            // First phase trail with enhanced particles
            const trailFollow1 = document.createElement('a-animation');
            trailFollow1.setAttribute('attribute', 'position');
            trailFollow1.setAttribute('from', ballPosition.x + ' ' + initialHeight + ' ' + ballPosition.z);
            trailFollow1.setAttribute('to', (ballPosition.x + direction.x) + ' ' + midPointHeight + ' ' + midPointZ);
            trailFollow1.setAttribute('dur', initialTimeToTravel);
            trailFollow1.setAttribute('easing', 'ease-out');
            particleTrail.appendChild(trailFollow1);
            
            // Add speed lines effect during initial throw
            const speedLines = document.createElement('a-entity');
            speedLines.setAttribute('position', ball.getAttribute('position'));
            speedLines.setAttribute('particle-system', 'preset: dust; color: #ffffff, #aaaaff; size: 0.05; particleCount: 30; maxAge: 0.5; velocityValue: 0 0.1 -1.5; velocitySpread: 0.5 0.2 0.5; accelerationValue: 0 0 0; enabled: true; opacity: 0.6');
            document.querySelector('a-scene').appendChild(speedLines);
            
            // Animate speed lines
            const speedLinesFollow = document.createElement('a-animation');
            speedLinesFollow.setAttribute('attribute', 'position');
            speedLinesFollow.setAttribute('from', ballPosition.x + ' ' + initialHeight + ' ' + ballPosition.z);
            speedLinesFollow.setAttribute('to', (ballPosition.x + direction.x) + ' ' + midPointHeight + ' ' + midPointZ);
            speedLinesFollow.setAttribute('dur', initialTimeToTravel);
            speedLinesFollow.setAttribute('easing', 'ease-out');
            speedLines.appendChild(speedLinesFollow);
            
            // Remove speed lines after first phase
            setTimeout(() => {
              document.querySelector('a-scene').removeChild(speedLines);
            }, initialTimeToTravel + 100);
            
            // Second phase trail with bounce effect
            setTimeout(() => {
              // Update particle effect for impact
              particleTrail.setAttribute('particle-system', 'particleCount: 100; maxAge: 1.2; velocityValue: 0 0.2 -1; velocitySpread: 0.8 0.5 0.3; accelerationValue: 0 -0.5 0; color: #3333ff, #0000aa, #6666ff, #ffffff; opacity: 0.8');
              
              // Follow bounce animation
              const trailBounce = document.createElement('a-animation');
              trailBounce.setAttribute('attribute', 'position');
              trailBounce.setAttribute('from', (ballPosition.x + direction.x) + ' ' + midPointHeight + ' ' + midPointZ);
              trailBounce.setAttribute('to', (ballPosition.x + direction.x * 1.5) + ' ' + 0.2 + ' ' + (midPointZ - 2));
              trailBounce.setAttribute('dur', secondPhaseTime * 0.4);
              trailBounce.setAttribute('easing', 'ease-in');
              particleTrail.appendChild(trailBounce);
              
              // Create dust cloud on impact
              setTimeout(() => {
                const impactDust = document.createElement('a-entity');
                impactDust.setAttribute('position', (ballPosition.x + direction.x * 1.5) + ' ' + 0.1 + ' ' + (midPointZ - 2));
                impactDust.setAttribute('particle-system', 'preset: dust; color: #ffffff, #dddddd; size: 0.08; particleCount: 50; maxAge: 0.8; velocityValue: 0 0.5 0; velocitySpread: 1 0.3 1; accelerationValue: 0 -0.2 0; enabled: true; opacity: 0.7');
                document.querySelector('a-scene').appendChild(impactDust);
                
                // Remove dust cloud after effect completes
                setTimeout(() => {
                  document.querySelector('a-scene').removeChild(impactDust);
                }, 1000);
                
                // Continue trail animation after bounce
                const trailFinal = document.createElement('a-animation');
                trailFinal.setAttribute('attribute', 'position');
                trailFinal.setAttribute('from', (ballPosition.x + direction.x * 1.7) + ' ' + 0.35 + ' ' + (midPointZ - 3));
                trailFinal.setAttribute('to', (ballPosition.x + direction.x * 2) + ' ' + finalHeight + ' ' + targetZ);
                trailFinal.setAttribute('dur', secondPhaseTime * 0.6);
                trailFinal.setAttribute('easing', 'ease-in');
                particleTrail.appendChild(trailFinal);
              }, secondPhaseTime * 0.4);
            }, initialTimeToTravel);
            
            // Hide trail after animation with fade effect
            setTimeout(() => {
              const fadeOut = document.createElement('a-animation');
              fadeOut.setAttribute('attribute', 'particle-system.opacity');
              fadeOut.setAttribute('from', '0.8');
              fadeOut.setAttribute('to', '0');
              fadeOut.setAttribute('dur', '300');
              particleTrail.appendChild(fadeOut);
              
              setTimeout(() => {
                particleTrail.setAttribute('visible', false);
              }, 300);
            }, totalAnimTime + 300);
            
            // Add camera follow effect
            const cameraEntity = document.querySelector('a-camera').parentElement;
            const cameraFollow = document.createElement('a-animation');
            cameraFollow.setAttribute('attribute', 'position');
            cameraFollow.setAttribute('from', cameraEntity.getAttribute('position').x + ' ' + cameraEntity.getAttribute('position').y + ' ' + cameraEntity.getAttribute('position').z);
            cameraFollow.setAttribute('to', cameraEntity.getAttribute('position').x + ' ' + cameraEntity.getAttribute('position').y + ' ' + (cameraEntity.getAttribute('position').z - 1));
            cameraFollow.setAttribute('dur', totalAnimTime / 2);
            cameraFollow.setAttribute('easing', 'ease-out');
            cameraEntity.appendChild(cameraFollow);
            
            // Return camera
            setTimeout(() => {
              const cameraReturn = document.createElement('a-animation');
              cameraReturn.setAttribute('attribute', 'position');
              cameraReturn.setAttribute('to', cameraEntity.getAttribute('position').x + ' ' + cameraEntity.getAttribute('position').y + ' ' + 3);
              cameraReturn.setAttribute('dur', 1000);
              cameraReturn.setAttribute('easing', 'ease-in-out');
              cameraEntity.appendChild(cameraReturn);
            }, totalAnimTime + 1000);
          };
          
          // Enhanced collision detection with realistic physics and chain reaction animations
          function checkCollisions() {
            let knockedPins = 0;
            let hasStrike = false;
            
            // Calculate more realistic collision based on ball path and physics
            const ballPosition = ball.getAttribute('position');
            
            // Determine pins to knock based on ball position with improved physics
            const centerImpact = Math.abs(ballPosition.x) < 0.5;
            const leftSide = ballPosition.x < -0.3;
            const rightSide = ballPosition.x > 0.3;
            
            // Calculate ball impact force based on speed (for more realistic physics)
            const impactForce = 1.2; // Base impact force
            
            // Different collision patterns based on where the ball hits with chain reaction
            let collidedPins = [];
            let chainReactionPins = [];
            
            // Primary impact pins (first hit by the ball) - Improved physics and more balanced strike probability
            // Calculate ball speed factor based on animation timing (faster = more impact)
            const speedFactor = Math.random() * 0.5 + 0.7; // Random factor between 0.7-1.2
            
            // Calculate precision factor based on how close to center the throw is
            const precisionFactor = 1 - (Math.abs(ballPosition.x) * 1.5); // Higher for center throws
            
            // Calculate skill factor - random element that simulates player skill/luck
            const skillFactor = Math.random();
            
            // Combined strike probability factor - all three must be good for a strike
            const strikeProbability = speedFactor * precisionFactor * skillFactor;
            
            if (centerImpact) {
              // Center hit - head pin and pins directly behind
              collidedPins = [0, 3, 4, 5];
              
              // Perfect throw has a moderate chance of strike - reduced from 0.4 to 0.25
              // Also requires more precision (x < 0.15 instead of 0.2)
              if (Math.abs(ballPosition.x) < 0.15 && strikeProbability > 0.7) {
                // Even with perfect conditions, only 25% chance of strike
                if (Math.random() < 0.25) {
                  collidedPins = Array.from({length: 10}, (_, i) => i);
                  hasStrike = true;
                } else {
                  // Good but not perfect hit - add more pins but not all
                  // This creates more varied gameplay with 7-9 pin hits
                  const additionalPins = [1, 2, 7, 8];
                  // Add some but not all additional pins
                  additionalPins.forEach(pin => {
                    if (Math.random() < strikeProbability * 0.8) {
                      collidedPins.push(pin);
                    }
                  });
                }
              }
            } else if (leftSide) {
              // Left side hit - pins on left side with more variation
              if (ballPosition.x < -0.6) { // Far left - fewer pins
                collidedPins = [1];
                if (Math.random() < 0.5) collidedPins.push(3);
              } else if (ballPosition.x < -0.4) { // Moderate left
                collidedPins = [1, 3];
                if (Math.random() < 0.4) collidedPins.push(6);
              } else { // Slight left
                collidedPins = [1, 3, 6];
                if (Math.random() < 0.3) collidedPins.push(0); // Sometimes hit head pin
              }
            } else if (rightSide) {
              // Right side hit - pins on right side with more variation
              if (ballPosition.x > 0.6) { // Far right - fewer pins
                collidedPins = [2];
                if (Math.random() < 0.5) collidedPins.push(5);
              } else if (ballPosition.x > 0.4) { // Moderate right
                collidedPins = [2, 5];
                if (Math.random() < 0.4) collidedPins.push(9);
              } else { // Slight right
                collidedPins = [2, 5, 9];
                if (Math.random() < 0.3) collidedPins.push(0); // Sometimes hit head pin
              }
            }
            
            // Calculate chain reaction based on primary impact
            // This simulates pins hitting other pins
            collidedPins.forEach(pinIndex => {
              // Each hit pin has a chance to knock down adjacent pins
              const pinPositions = [
                [0, 0, -10],      // Pin 0 (head)
                [-0.3, 0, -10.5], // Pin 1
                [0.3, 0, -10.5],  // Pin 2
                [-0.6, 0, -11],   // Pin 3
                [0, 0, -11],      // Pin 4
                [0.6, 0, -11],    // Pin 5
                [-0.9, 0, -11.5], // Pin 6
                [-0.3, 0, -11.5], // Pin 7
                [0.3, 0, -11.5],  // Pin 8
                [0.9, 0, -11.5]   // Pin 9
              ];
              
              // Define adjacent pins for each pin (pin neighborhood)
              const adjacentPins = [
                [1, 2],           // Pin 0 adjacent to 1, 2
                [0, 3, 4],        // Pin 1 adjacent to 0, 3, 4
                [0, 4, 5],        // Pin 2 adjacent to 0, 4, 5
                [1, 6, 7],        // Pin 3 adjacent to 1, 6, 7
                [1, 2, 3, 5, 7, 8], // Pin 4 adjacent to many
                [2, 4, 8, 9],     // Pin 5 adjacent to 2, 4, 8, 9
                [3, 7],           // Pin 6 adjacent to 3, 7
                [3, 4, 6, 8],     // Pin 7 adjacent to 3, 4, 6, 8
                [4, 5, 7, 9],     // Pin 8 adjacent to 4, 5, 7, 9
                [5, 8]            // Pin 9 adjacent to 5, 8
              ];
              
              // Add adjacent pins to chain reaction with probability based on impact
              adjacentPins[pinIndex].forEach(adjPin => {
                // Higher chance to knock down pins directly behind the hit pin
                const hitDirection = {
                  x: pinPositions[adjPin][0] - pinPositions[pinIndex][0],
                  z: pinPositions[adjPin][2] - pinPositions[pinIndex][2]
                };
                
                // Pins behind have higher chance of falling (z is more negative)
                const directionFactor = hitDirection.z < 0 ? 0.9 : 0.6;
                
                // Calculate probability based on distance and direction
                const distance = Math.sqrt(hitDirection.x * hitDirection.x + hitDirection.z * hitDirection.z);
                const probability = impactForce * directionFactor / (distance + 0.5);
                
                if (Math.random() < probability && !collidedPins.includes(adjPin) && !chainReactionPins.includes(adjPin)) {
                  chainReactionPins.push(adjPin);
                }
              });
            });
            
            // Combine primary impact and chain reaction pins
            const allFallingPins = [...collidedPins, ...chainReactionPins];
            knockedPins = allFallingPins.length;
            
            // Check for strike
            if (knockedPins === 10) {
              hasStrike = true;
            }
            
            // Pin falling physics and animation with improved realism
            allFallingPins.forEach(function(pinIndex, idx) {
              const pin = pins[pinIndex];
              const isChainReaction = chainReactionPins.includes(pinIndex);
              
              // Enhanced sound effects with variation based on pin type and impact force
              if (idx < 6) { // Allow more sounds for richer audio experience
                setTimeout(() => {
                  // Choose between different pin hit sounds based on impact type
                  let pinSound;
                  if (isChainReaction) {
                    // Chain reaction uses regular pin hit sound
                    pinSound = sounds.pinHit.clone();
                    pinSound.rate(0.9 + Math.random() * 0.3); // Randomize pitch
                    pinSound.volume(0.7); // Lower volume for chain reactions
                  } else if (idx < 2) {
                    // Primary impacts use harder hit sound
                    pinSound = sounds.pinHitHard.clone();
                    pinSound.rate(0.8 + Math.random() * 0.3); // Randomize pitch
                    pinSound.volume(0.9); // Louder for direct hits
                  } else {
                    // Mix of sounds for variety
                    pinSound = Math.random() > 0.5 ? sounds.pinHit.clone() : sounds.pinHitHard.clone();
                    pinSound.rate(0.8 + Math.random() * 0.4); // Randomize pitch
                    pinSound.volume(0.8); // Medium volume
                  }
                  pinSound.play();
                  
                  // Add pin-to-pin collision sounds for chain reactions
                  if (isChainReaction && Math.random() > 0.4) {
                    setTimeout(() => {
                      const collisionSound = sounds.pinCollision.clone();
                      collisionSound.rate(0.9 + Math.random() * 0.4);
                      collisionSound.volume(0.5 + Math.random() * 0.3);
                      collisionSound.play();
                    }, Math.random() * 200);
                  }
                }, isChainReaction ? (idx * 120 + 300) : (idx * 80)); // Staggered timing with chain reaction delay
              }
              
              // Calculate pin fall direction based on ball path or chain reaction source
              const pinPos = pin.getAttribute('position');
              const ballPos = ball.getAttribute('position');
              
              // Calculate fall direction and speed based on impact type
              let fallDirectionX, fallDirectionZ, fallSpeed;
              
              if (isChainReaction) {
                // For chain reaction, calculate direction based on the nearest primary impact pin
                let nearestPin = collidedPins[0];
                let minDistance = 999;
                
                collidedPins.forEach(primaryPin => {
                  const primaryPinPos = pins[primaryPin].getAttribute('position');
                  const distance = Math.sqrt(
                    Math.pow(primaryPinPos.x - pinPos.x, 2) + 
                    Math.pow(primaryPinPos.z - pinPos.z, 2)
                  );
                  
                  if (distance < minDistance) {
                    minDistance = distance;
                    nearestPin = primaryPin;
                  }
                });
                
                const sourcePinPos = pins[nearestPin].getAttribute('position');
                fallDirectionX = (pinPos.x - sourcePinPos.x) * 3;
                fallDirectionZ = (pinPos.z - sourcePinPos.z) * 0.5;
                fallSpeed = 600 + Math.random() * 200; // Slightly slower for chain reactions
              } else {
                // For primary impact, calculate direction based on ball position
                fallDirectionX = (pinPos.x - ballPos.x) * 2;
                fallDirectionZ = 0.5; // Slight forward push
                fallSpeed = 500 + Math.random() * 150; // Faster for direct hits
              }
              
              // Add randomness to make it more natural
              fallDirectionX += (Math.random() - 0.5) * 0.3;
              
              // Calculate realistic rotation based on impact direction
              const rotX = isChainReaction ? (Math.random() * 40 - 20) : 0;
              const rotY = Math.random() * 360; // Random spin
              const rotZ = fallDirectionX * 15; // Tilt based on direction
              
              // Animate pin falling with chain reaction timing and physics
              setTimeout(() => {
                // Efek partikel yang lebih dramatis saat pin terjatuh
                const pinParticles = document.createElement('a-entity');
                pinParticles.setAttribute('position', pin.getAttribute('position'));
                pinParticles.setAttribute('particle-system', {
                  color: isChainReaction ? '#EEEEEE, #DDDDDD' : '#FFFFFF, #FFFFAA',  // Warna lebih bervariasi
                  size: isChainReaction ? 0.04 : 0.05,  // Ukuran partikel lebih besar
                  maxAge: 1.0,  // Lifetime partikel lebih lama
                  velocityValue: '0 3.5 0',  // Kecepatan lebih tinggi
                  velocitySpread: '1.5 1.0 1.5',  // Spread lebih luas
                  accelerationValue: '0 -9 0',  // Akselerasi lebih kuat
                  particleCount: isChainReaction ? 15 : 25,  // Jumlah partikel lebih banyak
                  duration: 0.5,  // Durasi efek lebih lama
                  blending: 'additive', // Efek blending untuk cahaya yang lebih terang
                  opacity: 0.8 // Opacity yang lebih tinggi
                });
                document.querySelector('a-scene').appendChild(pinParticles);
                
                // Enhanced pin physics dengan gerakan jatuh yang lebih realistis dan dramatis
                // First, pin wobbles before falling dengan gerakan goyang yang lebih terlihat
                const wobbleAnimation = document.createElement('a-animation');
                wobbleAnimation.setAttribute('attribute', 'rotation');
                wobbleAnimation.setAttribute('from', '0 0 0');
                wobbleAnimation.setAttribute('to', (Math.random() * 15 - 7.5) + ' ' + (Math.random() * 30 - 15) + ' ' + (Math.random() * 15 - 7.5)); // Wobble lebih besar
                wobbleAnimation.setAttribute('dur', '200'); // Durasi lebih lama
                wobbleAnimation.setAttribute('easing', 'ease-in-out');
                pin.appendChild(wobbleAnimation);
                
                // Tambahkan efek flash kecil saat pin mulai jatuh
                if (!isChainReaction && Math.random() > 0.6) {
                  const pinFlash = document.createElement('a-entity');
                  pinFlash.setAttribute('position', pin.getAttribute('position'));
                  pinFlash.setAttribute('light', {
                    type: 'point',
                    color: '#ffffff',
                    intensity: '0.5',
                    distance: '0.5'
                  });
                  document.querySelector('a-scene').appendChild(pinFlash);
                  
                  // Hapus flash setelah efek selesai
                  setTimeout(() => {
                    document.querySelector('a-scene').removeChild(pinFlash);
                  }, 150);
                }
                
                // Then pin falls over with enhanced physics-based motion
                setTimeout(() => {
                  const fallAnimation = document.createElement('a-animation');
                  fallAnimation.setAttribute('attribute', 'rotation');
                  fallAnimation.setAttribute('to', rotX + ' ' + rotY + ' ' + rotZ);
                  fallAnimation.setAttribute('dur', fallSpeed.toString());
                  fallAnimation.setAttribute('easing', 'ease-out');
                  pin.appendChild(fallAnimation);
                  
                  // Move pin with enhanced physics (including realistic falling and sliding effect)
                  const fallPositionAnimation = document.createElement('a-animation');
                  fallPositionAnimation.setAttribute('attribute', 'position');
                  
                  // Improved falling animation dengan lompatan yang lebih realistis
                  const jumpHeight = isChainReaction ? 0.05 : 0.12; // Meningkatkan ketinggian lompatan
                  
                  fallPositionAnimation.setAttribute('from', pinPos.x + ' ' + pinPos.y + ' ' + pinPos.z);
                  fallPositionAnimation.setAttribute('to', 
                    (pinPos.x + fallDirectionX * 0.3) + ' ' + 
                    (pinPos.y + jumpHeight) + ' ' + 
                    (pinPos.z + fallDirectionZ * 0.3)); // Gerakan lebih jauh
                  fallPositionAnimation.setAttribute('dur', (fallSpeed * 0.2).toString()); // Gerakan awal lebih cepat
                  fallPositionAnimation.setAttribute('easing', 'ease-out');
                  pin.appendChild(fallPositionAnimation);
                  
                  // Second stage: more direct falling motion dengan slide yang lebih dramatis
                  setTimeout(() => {
                    const fallDownAnimation = document.createElement('a-animation');
                    fallDownAnimation.setAttribute('attribute', 'position');
                    fallDownAnimation.setAttribute('from', 
                      (pinPos.x + fallDirectionX * 0.3) + ' ' + 
                      (pinPos.y + jumpHeight) + ' ' + 
                      (pinPos.z + fallDirectionZ * 0.3));
                    fallDownAnimation.setAttribute('to', 
                      (pinPos.x + fallDirectionX * 1.2) + ' ' + 
                      '0.1' + ' ' + 
                      (pinPos.z + fallDirectionZ * 1.2)); // Jarak slide lebih jauh
                    fallDownAnimation.setAttribute('dur', (fallSpeed * 0.5).toString()); // Jatuh lebih cepat
                    fallDownAnimation.setAttribute('easing', 'ease-in');
                    pin.appendChild(fallDownAnimation);
                    
                    // Tambahkan efek getaran kecil saat pin jatuh ke lantai
                    if (Math.random() > 0.5) {
                      setTimeout(() => {
                        const scene = document.querySelector('a-scene');
                        scene.emit('shake', {duration: 100, intensity: 0.002}); // Getaran ringan
                      }, fallSpeed * 0.3);
                    }
                  }, fallSpeed * 0.25); // Timing lebih cepat
                }, 150);
                
                // Add reduced secondary movement for pins (less sliding for lighter effect)
                setTimeout(() => {
                  if (Math.random() < 0.5) { // Fewer pins slide (reduced from 0.7)
                    const slideAnimation = document.createElement('a-animation');
                    slideAnimation.setAttribute('attribute', 'position');
                    const currentPos = pin.getAttribute('position');
                    slideAnimation.setAttribute('from', 
                      currentPos.x + ' ' + 
                      currentPos.y + ' ' + 
                      currentPos.z);
                    slideAnimation.setAttribute('to', 
                      (currentPos.x + fallDirectionX * 0.2) + ' ' + 
                      currentPos.y + ' ' + 
                      (currentPos.z + fallDirectionZ * 1.2)); // Reduced sliding distance
                    slideAnimation.setAttribute('dur', '600'); // Shorter duration
                    slideAnimation.setAttribute('easing', 'ease-out');
                    pin.appendChild(slideAnimation);
                  }
                }, fallSpeed);
                
                // Remove particles after animation
                setTimeout(() => {
                  document.querySelector('a-scene').removeChild(pinParticles);
                }, 1200);
              }, isChainReaction ? (idx * 100 + 300) : (idx * 80)); // Staggered timing with chain reaction delay
            });
            
            // Update score with animation
            score += knockedPins;
            
            // Animate score increase
            const oldScore = parseInt(scoreDisplay.getAttribute('value').split(': ')[1]);
            const scoreIncrement = document.createElement('a-animation');
            scoreIncrement.setAttribute('attribute', 'value');
            scoreIncrement.setAttribute('from', 'Skor: ' + oldScore);
            scoreIncrement.setAttribute('to', 'Skor: ' + score);
            scoreIncrement.setAttribute('dur', '1000');
            scoreDisplay.appendChild(scoreIncrement);
            
            // Special effects for strike - Enhanced with more spectacular effects
            if (hasStrike) {
              // Play strike sound with enhanced volume
              const strikeSound = sounds.strike.clone();
              strikeSound.volume(1.2); // Increased volume
              strikeSound.play();
              
              // Create multiple strike texts with staggered animations for more festive effect
              const strikeColors = ['#FFD700', '#FF4500', '#00BFFF', '#FF1493', '#7CFC00'];
              const strikeTexts = ['STRIKE!!!', 'PERFECT!', 'AMAZING!', 'WOW!', 'SPECTACULAR!'];
              
              // Main strike text with enhanced animation
              const mainStrikeText = document.createElement('a-entity');
              mainStrikeText.setAttribute('position', '0 2 -5');
              mainStrikeText.setAttribute('text', {
                value: 'STRIKE!!!',
                color: strikeColors[0],
                align: 'center',
                width: 10,
                wrapCount: 20,
                shader: 'msdf',
                font: 'https://cdn.aframe.io/fonts/Exo2Bold.fnt' // Better font
              });
              document.querySelector('a-scene').appendChild(mainStrikeText);
              
              // Enhanced animation with multiple effects
              const strikeAnim1 = document.createElement('a-animation');
              strikeAnim1.setAttribute('attribute', 'scale');
              strikeAnim1.setAttribute('from', '0.1 0.1 0.1');
              strikeAnim1.setAttribute('to', '2.5 2.5 2.5'); // Larger scale
              strikeAnim1.setAttribute('dur', '800');
              strikeAnim1.setAttribute('easing', 'ease-out-elastic');
              mainStrikeText.appendChild(strikeAnim1);
              
              // Add rotation animation
              const strikeAnim2 = document.createElement('a-animation');
              strikeAnim2.setAttribute('attribute', 'rotation');
              strikeAnim2.setAttribute('from', '0 0 -10');
              strikeAnim2.setAttribute('to', '0 0 10');
              strikeAnim2.setAttribute('dir', 'alternate');
              strikeAnim2.setAttribute('repeat', '3');
              strikeAnim2.setAttribute('dur', '300');
              mainStrikeText.appendChild(strikeAnim2);
              
              // Add color pulse animation
              const strikeAnim3 = document.createElement('a-animation');
              strikeAnim3.setAttribute('attribute', 'text.color');
              strikeAnim3.setAttribute('from', strikeColors[0]);
              strikeAnim3.setAttribute('to', strikeColors[1]);
              strikeAnim3.setAttribute('dir', 'alternate');
              strikeAnim3.setAttribute('repeat', '4');
              strikeAnim3.setAttribute('dur', '400');
              mainStrikeText.appendChild(strikeAnim3);
              
              // Create smaller celebration texts around main text
              for (let i = 1; i < 4; i++) {
                setTimeout(() => {
                  const celebText = document.createElement('a-entity');
                  const xPos = (Math.random() - 0.5) * 4;
                  const yPos = 2 + (Math.random() - 0.5) * 1.5;
                  celebText.setAttribute('position', `${xPos} ${yPos} -5`);
                  celebText.setAttribute('text', {
                    value: strikeTexts[i],
                    color: strikeColors[i],
                    align: 'center',
                    width: 6,
                    wrapCount: 20
                  });
                  document.querySelector('a-scene').appendChild(celebText);
                  
                  // Animate celebration text
                  const celebAnim = document.createElement('a-animation');
                  celebAnim.setAttribute('attribute', 'scale');
                  celebAnim.setAttribute('from', '0.1 0.1 0.1');
                  celebAnim.setAttribute('to', '1.5 1.5 1.5');
                  celebAnim.setAttribute('dur', '600');
                  celebAnim.setAttribute('easing', 'ease-out');
                  celebText.appendChild(celebAnim);
                  
                  // Add movement animation
                  const moveAnim = document.createElement('a-animation');
                  moveAnim.setAttribute('attribute', 'position');
                  moveAnim.setAttribute('to', `${xPos + (Math.random() - 0.5) * 2} ${yPos + 0.5} -5`);
                  moveAnim.setAttribute('dur', '1500');
                  moveAnim.setAttribute('easing', 'ease-in-out');
                  celebText.appendChild(moveAnim);
                  
                  // Fade out and remove
                  setTimeout(() => {
                    const fadeOut = document.createElement('a-animation');
                    fadeOut.setAttribute('attribute', 'opacity');
                    fadeOut.setAttribute('from', '1');
                    fadeOut.setAttribute('to', '0');
                    fadeOut.setAttribute('dur', '400');
                    celebText.appendChild(fadeOut);
                    
                    setTimeout(() => {
                      document.querySelector('a-scene').removeChild(celebText);
                    }, 400);
                  }, 1500);
                }, i * 200); // Staggered appearance
              }
              
              // Fade out and remove main text
              setTimeout(() => {
                const fadeDur = 600;
                const fadeOut = document.createElement('a-animation');
                fadeOut.setAttribute('attribute', 'opacity');
                fadeOut.setAttribute('from', '1');
                fadeOut.setAttribute('to', '0');
                fadeOut.setAttribute('dur', fadeDur);
                mainStrikeText.appendChild(fadeOut);
                
                setTimeout(() => {
                  document.querySelector('a-scene').removeChild(mainStrikeText);
                }, fadeDur);
              }, 2500);
              
              // Enhanced message display
              document.querySelector('#message-display').setAttribute('value', 'STRIKE SPEKTAKULER!!!');
              
              // Enhanced particle explosion effects
              const particleExplosion = document.querySelector('#strike-particles');
              particleExplosion.setAttribute('position', '0 1 -10');
              particleExplosion.setAttribute('particle-system', {
                preset: 'dust',
                color: '#FFFF00, #FF4500, #00BFFF, #FF1493, #7CFC00',
                size: 0.2,
                particleCount: 120,
                maxAge: 2,
                velocityValue: '0 8 0',
                velocitySpread: '5 3 5',
                accelerationValue: '0 -10 0',
                opacity: 0.9,
                blending: 'additive'
              });
              particleExplosion.setAttribute('visible', true);
              
              // Add confetti effect
              const confetti = document.createElement('a-entity');
              confetti.setAttribute('position', '0 3 -8');
              confetti.setAttribute('particle-system', {
                preset: 'dust',
                color: '#FFFF00, #FF4500, #00BFFF, #FF1493, #7CFC00, #FFFFFF',
                size: 0.1,
                particleCount: 150,
                maxAge: 3,
                velocityValue: '0 -5 0',
                velocitySpread: '8 2 8',
                accelerationValue: '0 -2 0',
                opacity: 0.9,
                blending: 'additive'
              });
              document.querySelector('a-scene').appendChild(confetti);
              
              // Add camera shake for impact
              const scene = document.querySelector('a-scene');
              scene.emit('shake', {duration: 500, intensity: 0.008});
              
              // Remove particles after animation
              setTimeout(() => {
                particleExplosion.setAttribute('visible', false);
                document.querySelector('a-scene').removeChild(confetti);
              }, 3000);
            } else {
              document.querySelector('#message-display').setAttribute('value', 'Kamu menjatuhkan ' + knockedPins + ' pin!');
            }
            
            // Update frame count
            frameCount++;
            if (frameCount > 10) frameCount = 10; // Cap at 10
            frameDisplay.setAttribute('value', 'Frame: ' + frameCount + '/10');
            
            // Hide ball temporarily with fade effect
            const ballHide = document.createElement('a-animation');
            ballHide.setAttribute('attribute', 'opacity');
            ballHide.setAttribute('from', '1');
            ballHide.setAttribute('to', '0');
            ballHide.setAttribute('dur', '500');
            ball.appendChild(ballHide);
            
            setTimeout(() => {
              ball.setAttribute('visible', false);
              
              // Show reset button with animation
              const resetButton = document.querySelector('#reset-button');
              resetButton.setAttribute('visible', true);
              resetButton.setAttribute('scale', '0.5 0.5 0.5');
              
              const resetButtonAnim = document.createElement('a-animation');
              resetButtonAnim.setAttribute('attribute', 'scale');
              resetButtonAnim.setAttribute('to', '1 1 1');
              resetButtonAnim.setAttribute('dur', '500');
              resetButtonAnim.setAttribute('easing', 'ease-out-elastic');
              resetButton.appendChild(resetButtonAnim);
              
              // Add event listener to reset button
              resetButton.addEventListener('click', function() {
                resetScene();
              });
              
              // Game over check
              if (frameCount >= 10) {
                document.querySelector('#message-display').setAttribute('value', 'Permainan Selesai! Skor Akhir: ' + score);
                
                // Show final score with animation
                const finalScoreDisplay = document.createElement('a-entity');
                finalScoreDisplay.setAttribute('position', '0 1.5 -3');
                finalScoreDisplay.setAttribute('text', {
                  value: 'SKOR AKHIR: ' + score,
                  color: 'gold',
                  align: 'center',
                  width: 5,
                  wrapCount: 20
                });
                finalScoreDisplay.setAttribute('scale', '0.1 0.1 0.1');
                document.querySelector('a-scene').appendChild(finalScoreDisplay);
                
                const finalScoreAnim = document.createElement('a-animation');
                finalScoreAnim.setAttribute('attribute', 'scale');
                finalScoreAnim.setAttribute('to', '1 1 1');
                finalScoreAnim.setAttribute('dur', '1000');
                finalScoreAnim.setAttribute('easing', 'ease-out-elastic');
                finalScoreDisplay.appendChild(finalScoreAnim);
                
                // Remove after some time
                setTimeout(() => {
                  document.querySelector('a-scene').removeChild(finalScoreDisplay);
                }, 5000);
                
                // Reset game on next click
                resetButton.setAttribute('text', {
                  value: 'MAIN BARU',
                  color: '#FFFFFF',
                  align: 'center',
                  width: 2
                });
              }
            }, 1000);
          }
          
          // Initial setup
          resetScene();
        }
      });
    });
  </script>
</head>
<body>
  <a-scene vr-mode-ui="enabled: true">
    <!-- Environment with improved textures -->
    <a-assets>
      <img id="wood" src="/api/placeholder/400/320" alt="wood texture">
      <img id="floor" src="/api/placeholder/400/320" alt="floor texture">
      <img id="ceiling" src="/api/placeholder/400/320" alt="ceiling texture">
      <img id="wallTexture" src="/api/placeholder/400/320" alt="wall texture">
    </a-assets>
    
    <!-- Environment with lighting & atmosphere -->
    <a-sky color="#000033"></a-sky>
    <a-entity light="type: ambient; intensity: 0.3; color: #bbbbff"></a-entity>
    <a-entity light="type: directional; intensity: 0.8; position: -1 1 1; color: #ffffff; castShadow: true"></a-entity>
    <a-entity light="type: spot; intensity: 0.5; position: 0 5 -5; color: #ffff99; angle: 45; penumbra: 0.2; castShadow: true"></a-entity>
    
    <!-- Bowling Alley Environment -->
    <a-entity position="0 0 -5">
      <!-- Floor -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="15" height="30" color="#222" material="src: #floor; repeat: 15 30; normalTextureRepeat: 15 30"></a-plane>
      
      <!-- Ceiling -->
      <a-plane position="0 5 0" rotation="90 0 0" width="15" height="30" color="#111" material="src: #ceiling; repeat: 15 30"></a-plane>
      
      <!-- Walls -->
      <a-entity position="-7.5 2.5 0">
        <a-box width="0.5" height="5" depth="30" color="#333" material="src: #wallTexture; repeat: 1 10"></a-box>
      </a-entity>
      <a-entity position="7.5 2.5 0">
        <a-box width="0.5" height="5" depth="30" color="#333" material="src: #wallTexture; repeat: 1 10"></a-box>
      </a-entity>
      <a-entity position="0 2.5 -15">
        <a-box width="15" height="5" depth="0.5" color="#333" material="src: #wallTexture; repeat: 5 2"></a-box>
      </a-entity>
      
      <!-- Decorative lights -->
      <a-entity position="-6 4 0">
        <a-box width="0.2" height="0.2" depth="25" color="#555"></a-box>
        <a-entity position="0 0 -5">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
        <a-entity position="0 0 0">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
        <a-entity position="0 0 5">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
      </a-entity>
      <a-entity position="6 4 0">
        <a-box width="0.2" height="0.2" depth="25" color="#555"></a-box>
        <a-entity position="0 0 -5">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
        <a-entity position="0 0 0">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
        <a-entity position="0 0 5">
          <a-sphere radius="0.1" color="#ffff00" light="type: point; intensity: 0.5; color: #ffff99; distance: 5"></a-sphere>
        </a-entity>
      </a-entity>
    </a-entity>
    
    <!-- Bowling Lane with improved textures -->
    <a-box position="0 0.01 -5" width="1.2" height="0.02" depth="15" color="#8B4513" material="src: #wood; repeat: 1 15"></a-box>
    
    <!-- Lane Gutters (Improved) -->
    <a-entity position="-0.8 0.1 -5">
      <a-box width="0.3" height="0.2" depth="15" color="#555" material="metalness: 0.3"></a-box>
      <a-cylinder position="0.15 0 0" rotation="0 0 90" radius="0.1" height="0.3" color="#444" material="metalness: 0.5"></a-cylinder>
    </a-entity>
    <a-entity position="0.8 0.1 -5">
      <a-box width="0.3" height="0.2" depth="15" color="#555" material="metalness: 0.3"></a-box>
      <a-cylinder position="-0.15 0 0" rotation="0 0 90" radius="0.1" height="0.3" color="#444" material="metalness: 0.5"></a-cylinder>
    </a-entity>
    
    <!-- Lane Finish Line -->
    <a-entity position="0 0.02 -9.5">
      <a-box width="1.2" height="0.03" depth="0.05" color="#222"></a-box>
    </a-entity>
    
    <!-- Spot/Target Marks on Lane -->
    <a-entity position="0 0.03 -3">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    <a-entity position="-0.2 0.03 -3">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    <a-entity position="0.2 0.03 -3">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    <a-entity position="0 0.03 -6">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    <a-entity position="-0.2 0.03 -6">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    <a-entity position="0.2 0.03 -6">
      <a-cylinder radius="0.05" height="0.01" color="#333"></a-cylinder>
    </a-entity>
    
    <!-- Enhanced Bowling Ball with reflection & glow -->
    <a-sphere id="bowling-ball" position="0 0.3 1" radius="0.22" color="#000066" material="metalness: 0.2; roughness: 0.3" class="clickable" ball-control>
      <!-- Ball finger holes -->
      <a-entity position="0 0.15 0">
        <a-cylinder radius="0.03" height="0.1" color="#000033" rotation="30 0 0"></a-cylinder>
      </a-entity>
      <a-entity position="0.06 0.15 0.06">
        <a-cylinder radius="0.03" height="0.1" color="#000033" rotation="30 30 0"></a-cylinder>
      </a-entity>
      <a-entity position="-0.06 0.15 0.06">
        <a-cylinder radius="0.03" height="0.1" color="#000033" rotation="30 -30 0"></a-cylinder>
      </a-entity>
    </a-sphere>
    
   <!-- Ball glow effect -->
<a-entity id="ball-glow" position="0 0.3 1" visible="false">
  <a-sphere radius="0.25" color="#3333ff" material="opacity: 0.3; transparent: true">
    <a-animation attribute="scale" from="1 1 1" to="1.2 1.2 1.2" dir="alternate" dur="1000" repeat="indefinite" easing="ease-in-out"></a-animation>
  </a-sphere>
</a-entity>

<!-- Enhanced Bowling Pins -->
<a-entity position="0 0 0">
  <!-- Pin 1 (Head Pin) -->
  <a-entity class="pin" position="0 0.25 -10">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <!-- Red stripe details -->
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <!-- Pin top -->
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <!-- Row 2 -->
  <a-entity class="pin" position="-0.3 0.25 -10.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="0.3 0.25 -10.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <!-- Row 3 -->
  <a-entity class="pin" position="-0.6 0.25 -11">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="0 0.25 -11">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="0.6 0.25 -11">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <!-- Row 4 -->
  <a-entity class="pin" position="-0.9 0.25 -11.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="-0.3 0.25 -11.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="0.3 0.25 -11.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
  
  <a-entity class="pin" position="0.9 0.25 -11.5">
    <a-cylinder radius="0.07" radius-top="0.05" height="0.5" color="white" material="metalness: 0.2; roughness: 0.4">
      <a-torus position="0 0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-torus position="0 -0.1 0" rotation="90 0 0" radius="0.07" radius-tubular="0.01" color="red" material="metalness: 0.3"></a-torus>
      <a-entity position="0 0.3 0">
        <a-sphere radius="0.05" color="white" material="metalness: 0.2; roughness: 0.4"></a-sphere>
      </a-entity>
    </a-cylinder>
  </a-entity>
</a-entity>

<!-- Enhanced Particle Systems for Effects -->
<a-entity id="ball-trail" visible="false" position="0 0.3 1" particle-system="preset: dust; color: #3333ff, #0000aa; size: 0.1; particleCount: 60; maxAge: 1.2; velocityValue: 0 0 -0.5; accelerationSpread: 0.2 0.2 0.2; enabled: true; opacity: 0.8"></a-entity>

<a-entity id="strike-particles" visible="false" particle-system="preset: stars; color: #ffff00, #ff0000, #ffaa00; size: 0.5; particleCount: 150; maxAge: 2.5; velocityValue: 0 3 0; velocitySpread: 5 2 5; accelerationValue: 0 -5 0; enabled: true; opacity: 0.9"></a-entity>

<a-entity id="new-frame-particles" visible="false" position="0 2 -1" particle-system="preset: snow; color: #ffffff, #aaaaff; size: 0.2; particleCount: 30; maxAge: 2; velocityValue: 0 -1 0; velocitySpread: 2 0 0; enabled: true"></a-entity>

<!-- New collision particles for pin impacts -->
<a-entity id="pin-collision-particles" visible="false" particle-system="preset: dust; color: #ffffff, #dddddd, #aaaaaa; size: 0.08; particleCount: 80; maxAge: 1; velocityValue: 0 2 0; velocitySpread: 2 1 2; accelerationValue: 0 -8 0; enabled: true; opacity: 0.9"></a-entity>

<!-- Ball impact flash effect -->
<a-entity id="impact-flash" visible="false" position="0 0.3 -10">
  <a-sphere radius="0.5" color="#ffffff" material="opacity: 0.7; transparent: true; shader: flat">
    <a-animation attribute="scale" from="0.1 0.1 0.1" to="3 3 3" dur="300" easing="ease-out"></a-animation>
    <a-animation attribute="opacity" from="0.7" to="0" dur="300" easing="ease-out"></a-animation>
  </a-sphere>
</a-entity>

<!-- Camera with cursor and shake effect -->
<a-entity position="0 .7 3">
  <a-camera wasd-controls look-controls camera-shake>
    <a-cursor fuse="true" fuse-timeout="500" color="white" animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
              animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
              animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
              raycaster="objects: .clickable; far: 20"></a-cursor>
  </a-camera>
</a-entity>

<!-- Enhanced UI Elements with animation -->
<a-entity position="0 2.5 -1" look-at="[camera]">
  <a-text id="message-display" value="Klik bola untuk mulai" color="white" align="center" width="5" animation__color="property: color; dir: alternate; dur: 1000; easing: easeInOutSine; loop: true; to: #ffff00"></a-text>
  <a-text id="score-display" position="0 -0.3 0" value="Skor: 0" color="white" align="center" width="5"></a-text>
  <a-text id="frame-display" position="0 -0.6 0" value="Frame: 1/10" color="white" align="center" width="5"></a-text>
</a-entity>

<!-- Enhanced Throw Button -->
<a-entity id="throw-button" position="0 1 1" visible="false" class="clickable">
  <a-box width="0.6" height="0.2" depth="0.1" color="#00AA00" material="opacity: 0.9; transparent: true" class="clickable" onclick="throwBall()"
    animation__hover="property: material.opacity; from: 0.9; to: 1; startEvents: mouseenter; dir: normal; dur: 200"
    animation__leave="property: material.opacity; from: 1; to: 0.9; startEvents: mouseleave; dir: normal; dur: 200"
    animation__click="property: scale; from: 1 1 1; to: 0.9 0.9 0.9; startEvents: click; dir: alternate; dur: 100"></a-box>
  <a-text value="LEMPAR" position="0 0 0.06" color="#FFFFFF" align="center" width="2"></a-text>
  <a-light type="point" intensity="0.3" color="#00ff00" distance="0.6"></a-light>
</a-entity>

<!-- Enhanced Reset Button (Hidden Initially) -->
<a-entity id="reset-button" position="0 0.7 1" visible="false" class="clickable">
  <a-box width="0.6" height="0.2" depth="0.1" color="#DD0000" material="opacity: 0.9; transparent: true" class="clickable" onclick="resetScene()"
    animation__hover="property: material.opacity; from: 0.9; to: 1; startEvents: mouseenter; dir: normal; dur: 200"
    animation__leave="property: material.opacity; from: 1; to: 0.9; startEvents: mouseleave; dir: normal; dur: 200"
    animation__click="property: scale; from: 1 1 1; to: 0.9 0.9 0.9; startEvents: click; dir: alternate; dur: 100"></a-box>
  <a-text value="ULANG" position="0 0 0.06" color="#FFFFFF" align="center" width="2"></a-text>
  <a-light type="point" intensity="0.3" color="#ff0000" distance="0.6"></a-light>
</a-entity>

<!-- Enhanced Ball Rack -->
<a-entity position="-1.5 0.5 2">
  <a-box width="1" height="1" depth="1" color="#555" material="metalness: 0.7; roughness: 0.3"></a-box>
  <a-entity position="0 0.5 0">
    <a-cylinder radius="0.5" height="0.1" color="#333" material="metalness: 0.8; roughness: 0.2"></a-cylinder>
    <!-- Additional spheres representing other bowling balls -->
    <a-sphere position="0.25 0.15 0" radius="0.18" color="#aa0000" material="metalness: 0.2; roughness: 0.3"></a-sphere>
    <a-sphere position="-0.25 0.15 0" radius="0.18" color="#006600" material="metalness: 0.2; roughness: 0.3"></a-sphere>
  </a-entity>
  <a-text value="Rak Bola" position="0 0.7 0" color="white" align="center" width="2"></a-text>
  <a-light type="point" intensity="0.5" color="#ffffff" distance="2"></a-light>
</a-entity>

<!-- Enhanced Hand (with animation) -->
<a-entity id="player-hand" position="0 0.8 2" visible="false">
  <a-box width="0.08" height="0.3" depth="0.08" color="#F5DEB3"></a-box>
  <a-entity position="0 0.15 0.05">
    <a-box width="0.03" height="0.2" depth="0.03" color="#F5DEB3" position="0.025 0 0" rotation="0 0 -10"></a-box>
    <a-box width="0.03" height="0.2" depth="0.03" color="#F5DEB3" position="-0.025 0 0" rotation="0 0 10"></a-box>
  </a-entity>
</a-entity>

<!-- Scoreboard -->
<a-entity position="3 2 -3" rotation="0 -45 0">
  <a-plane width="2" height="1.5" color="#000" opacity="0.7">
    <a-text value="BOWLING SCORECARD" position="0 0.6 0.01" color="#ffff00" align="center" width="4"></a-text>
    <a-text id="total-score-display" value="Skor Total: 0" position="0 0.3 0.01" color="white" align="center" width="4"></a-text>
    <a-text value="TERIMA KASIH TELAH BERMAIN!" position="0 -0.6 0.01" color="#ffff00" align="center" width="4"></a-text>
  </a-plane>
</a-entity>

<!-- Decorative Elements -->
<!-- Trophy display -->
<a-entity position="3 1 -8" rotation="0 -45 0">
  <a-box width="1" height="2" depth="1" color="#332211" material="src: #wood"></a-box>
  <a-entity position="0 1.2 0">
    <a-cylinder height="0.3" radius="0.1" color="#FFD700" material="metalness: 1; roughness: 0.1"></a-cylinder>
    <a-entity position="0 0.3 0">
      <a-sphere radius="0.2" color="#FFD700" material="metalness: 1; roughness: 0.1"></a-sphere>
      <a-cylinder position="0 0.2 0" height="0.4" radius="0.05" color="#FFD700" material="metalness: 1; roughness: 0.1"></a-cylinder>
      <!-- Trophy handles -->
      <a-torus position="0 0 0" rotation="90 0 0" radius="0.3" radius-tubular="0.02" color="#FFD700" material="metalness: 1; roughness: 0.1" arc="180" side="double"></a-torus>
    </a-entity>
  </a-entity>
  <a-text value="TROPHY" position="0 0 0.51" color="#FFD700" align="center" width="2"></a-text>
  <a-light type="spot" color="#ffff00" intensity="0.5" angle="45" distance="5" position="0 3 1" target="#trophy-target"></a-light>
  <a-entity id="trophy-target" position="0 1.2 0"></a-entity>
</a-entity>

<!-- Ambient music controls -->
<a-entity position="-3 1.5 -2" rotation="0 45 0">
  <a-plane width="1" height="0.5" color="#222222">
    <a-text value="MUSIC" position="0 0.15 0.01" color="white" align="center" width="2"></a-text>
    <a-entity position="-0.3 -0.1 0.05" class="clickable" onclick="toggleMusicOn()">
      <a-cylinder radius="0.1" height="0.05" color="#00aa00"></a-cylinder>
      <a-text value="ON" position="0 0 0.05" color="white" align="center" scale="0.5 0.5 0.5"></a-text>
    </a-entity>
    <a-entity position="0.3 -0.1 0.05" class="clickable" onclick="toggleMusicOff()">
      <a-cylinder radius="0.1" height="0.05" color="#aa0000"></a-cylinder>
      <a-text value="OFF" position="0 0 0.05" color="white" align="center" scale="0.5 0.5 0.5"></a-text>
    </a-entity>
  </a-plane>
</a-entity>

<!-- Bowling logo -->
<a-entity position="0 3.5 -12">
  <a-plane width="3" height="1" color="#000066" opacity="0.9">
    <a-text value="VR BOWLING" position="0 0 0.01" color="#ffff00" align="center" width="6" scale="1.5 1.5 1.5"></a-text>
  </a-plane>
</a-entity>

<!-- Ambient people silhouettes to make the alley feel populated -->
<a-entity position="-4 1 -5">
  <a-box width="0.5" height="2" depth="0.3" color="#111111" opacity="0.7"></a-box>
  <a-sphere position="0 1.2 0" radius="0.25" color="#111111" opacity="0.7"></a-sphere>
</a-entity>

<a-entity position="-5 1 -8">
  <a-box width="0.5" height="2" depth="0.3" color="#111111" opacity="0.7"></a-box>
  <a-sphere position="0 1.2 0" radius="0.25" color="#111111" opacity="0.7"></a-sphere>
</a-entity>

<a-entity position="4 1 -7">
  <a-box width="0.5" height="2" depth="0.3" color="#111111" opacity="0.7"></a-box>
  <a-sphere position="0 1.2 0" radius="0.25" color="#111111" opacity="0.7"></a-sphere>
</a-entity>

<!-- Light show for strikes -->
<a-entity position="0 4 -10">
  <a-entity id="strike-light-left" visible="false" light="type: spot; color: #ff0000; intensity: 0; angle: 30; penumbra: 0.5; distance: 20">
    <a-animation attribute="light.intensity" from="0" to="2" dur="500" begin="strike-event"></a-animation>
    <a-animation attribute="light.intensity" from="2" to="0" dur="500" begin="strike-event+2000"></a-animation>
  </a-entity>
  <a-entity id="strike-light-right" visible="false" light="type: spot; color: #0000ff; intensity: 0; angle: 30; penumbra: 0.5; distance: 20">
    <a-animation attribute="light.intensity" from="0" to="2" dur="500" begin="strike-event"></a-animation>
    <a-animation attribute="light.intensity" from="2" to="0" dur="500" begin="strike-event+2000"></a-animation>
  </a-entity>
</a-entity>

<!-- Footer disclaimer -->
<a-text position="0 0.1 -13" rotation="-90 0 0" value="VR Bowling Experience - Improved Version" color="#666666" align="center" width="5"></a-text>



<!-- Instructions panel -->
<a-entity position="-3 2 0" rotation="0 90 0">
  <a-plane width="2" height="1.5" color="#222" opacity="0.8">
    <a-text value="CARA BERMAIN" position="0 0.6 0.01" color="#ffff00" align="center" width="4"></a-text>
    <a-text value="1. Klik bola untuk mengambil" position="0 0.3 0.01" color="white" align="left" width="1.8" scale="0.75 0.75 0.75"></a-text>
    <a-text value="2. Klik tombol LEMPAR" position="0 0.1 0.01" color="white" align="left" width="1.8" scale="0.75 0.75 0.75"></a-text>
    <a-text value="3. Lihat pin jatuh!" position="0 -0.1 0.01" color="white" align="left" width="1.8" scale="0.75 0.75 0.75"></a-text>
    <a-text value="4. Klik ULANG untuk lanjut" position="0 -0.3 0.01" color="white" align="left" width="1.8" scale="0.75 0.75 0.75"></a-text>
  </a-plane>
</a-entity>
</a-scene>
</body>
</html>